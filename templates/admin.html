{% extends "layout.html" %}

{% block title %}Admin Panel{% endblock %}

{% block content %}
<h2>Request a Submittal</h2>

<form method="POST">
    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">

    <div class="form-group">
        <label for="name"><strong>Request Name:</strong></label>
        <input type="text" name="name" id="name" placeholder="Name..." style="width: 30%;" required>
    </div>

    <div class="form-group">
        <label for="description"><strong>Description (optional):</strong></label>
        <textarea name="description" id="description" rows="3" style="width: 30%;" placeholder="Add notes..."></textarea>
    </div>

    <label for="project">Select Project:</label>
    <select name="project" class="input_small" required>
        {% for project in projects %}
            <option value="{{ project.id }}">{{ project.project_name }}</option>
        {% else %}
            <option disabled>No projects found</option>
        {% endfor %}
    </select>

    <label for="submitter">Select Submitter:</label>
    <select name="submitter" class="input_small" required>
        {% for sub in subs %}
            <option value="{{ sub.id }}">{{ sub.name }}</option>
        {% else %}
            <option disabled>No submitters found</option>
        {% endfor %}
    </select>

    <label for="set">Select Requirement Set:</label>
    <select name="set" class="input_small" required>
        {% for set in sets %}
            <option value="{{ set.id }}">{{ set.name }}</option>
        {% else %}
            <option disabled>No sets found</option>
        {% endfor %}
    </select>

    <br><br>
    <button type="submit">Create Request</button>
</form>

<hr>

<h3>Existing Submittal Requests</h3>

<table border="1" cellpadding="8" cellspacing="0">
    <tr>
        <th>Submission Name</th>
        <th>Project number</th>
        <th>Project name</th>
        <th>Submitter</th>
        <th>Status</th>
        <th>Delete Submission</th>
    </tr>

    {% for req in this_req|reverse %}
    <tr>
        <td><a href="/review_submission/{{ req.token }}">{{ req.request_name }}</a></td>
        <td>{{ req.project_number }}</td>
        <td><a href="/project_summary/{{ req.project_id }}">{{ req.project_name }}</a></td>
        <td>{{ req.name }}</td>
        <td>
            <span class="badge badge-{{ req.status }}">
                {{ req.status.replace("_", " ").title() }}
            </span>
        </td>
        <td>
            <form method="post" style="display:inline;">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                <input type="hidden" name="delete" value="{{ req.req_id }}">
                <button type="submit" onclick="return confirm('Are you sure you want to delete this request?');">Delete</button>
            </form>
        </td>
    </tr>
    {% else %}
    <tr>
        <td colspan="6">No requests yet.</td>
    </tr>
    {% endfor %}
</table>
{% endblock %}
