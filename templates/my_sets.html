{% extends "layout.html" %}

{% block title %}Requirement Sets{% endblock %}

{% block content %}

    {% with messages = get_flashed_messages() %}
    {% if messages %}
       <div class="flash-messages">
        {% for message in messages %}
        <div class="flash">{{ message }}</div>
        {% endfor %}
       </div>
    {% endif %}
    {% endwith %}

    <!-- Form to create a new set -->
    <form method="post">
        <h2>Create a Set</h2>
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
        <div>
            <input type="text" name="new_set_name" placeholder="New set name" autocomplete="off" required>
        </div>
        <button type="submit">Create Set</button>
    </form>

    <h2>Existing Sets</h2>

    {% if doc_sets %}
        <table>
            <thead>
                <tr>
                    <th>Set Name</th>
                    <th>Required Documents</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody>
                {% for set in doc_sets|reverse %}
                <tr>
                    <td>{{ set.name }}</td>
                    <td>
                        {% if docs_by_set[set.id] %}
                            <ul>
                                {% for doc in docs_by_set[set.id] %}
                                    <li>{{ doc.doc_type }}</li>
                                {% endfor %}
                            </ul>
                        {% else %}
                            <em>No documents assigned yet</em>
                        {% endif %}
                    </td>
                    <td>
                        <a href="{{ url_for('edit_set', set_id=set.id) }}">
                            <button type="button">Edit</button>
                        </a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    {% else %}
        <p>No sets yet.</p>
    {% endif %}

{% endblock %}