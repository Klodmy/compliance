<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Submit Required Documents</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <style>
        .upload-area {
            margin-top: 10px;
            padding: 15px;
            background-color: #f0f8ff;
            border: 1px solid #cce5ff;
            border-radius: 5px;
        }

        .upload-area input[type="file"] {
            margin-bottom: 10px;
        }
    </style>
</head>
<body>

    <nav style="background-color: #f0f0f0; padding: 10px;">
        <a href="/submitter_dashboard" style="margin-right: 15px;">Dashboard</a>
        <a href="/logout">Log Out</a>
    </nav>

    <h2>Documents Submission</h2>
    <h3>Submission Title: {{ doc_request["name"] }}</h3>
    <h3>Project: {{ project_name["project_name"] }}</h3>
    <p><strong>Description:</strong> {{ doc_request["description"] }}</p>

    {% with messages = get_flashed_messages() %}
    {% if messages %}
        <div class="flash-messages">
            {% for message in messages %}
                <div class="flash">{{ message }}</div>
            {% endfor %}
        </div>
    {% endif %}
    {% endwith %}

    <form method="post" action="/submission/{{ doc_request['token'] }}" enctype="multipart/form-data">
        {% for doc in required_docs %}
            <div class="doc-block" style="margin-bottom: 20px;">
                <strong>{{ doc["doc_type"] }}</strong><br>

                {% set status = doc["doc_status"] if "doc_status" in doc else "missing" %}
                <span class="status {{ status.replace('_', '-') }}">{{ status.replace("_", " ").title() }}</span><br>

                {% if doc["link"] %}
                    <div style="margin-top: 5px;">
                        Current file: <a href="{{ doc['link'] }}" target="_blank">View submitted</a>
                    </div>
                {% endif %}

                {% if status == "action_required" and doc.comment %}
                    <div style="margin-top: 10px; color: #d9534f;">
                        <strong>Note:</strong> {{ doc.comment }}
                    </div>
                {% endif %}

                {% if not doc["link"] or status == "action_required" %}
                    <div class="upload-area">
                        <label for="{{ doc['doc_type'] }}">Upload New File:</label><br>
                        <input type="file" name="{{ doc['doc_type'] }}" required><br>

                        {% if doc.expiry_required == 1 %}
                            <label for="{{ doc['doc_type'] }}_expiry">Expiry Date (Required):</label><br>
                            <input type="date" name="{{ doc['doc_type'] }}_expiry" required><br>
                        {% else %}
                            <label for="{{ doc['doc_type'] }}_expiry">Expiry Date (Optional):</label><br>
                            <input type="date" name="{{ doc['doc_type'] }}_expiry"><br>
                        {% endif %}

                        {% if doc["id"] %}
                            <input type="hidden" name="doc_id_{{ doc['doc_type'] }}" value="{{ doc['id'] }}">
                        {% endif %}
                    </div>
                {% else %}
                    <div class="locked" style="color: gray; font-style: italic; margin-top: 10px;">
                        Submission locked â€” already submitted
                    </div>
                {% endif %}
            </div>
        {% endfor %}

        <button type="submit">Submit All</button>
    </form>

</body>
</html>

